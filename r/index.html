<head>
    <title>QRoll</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">   
    <link rel="stylesheet" href="/QRoll/style/main.css">
</head>  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<header>
    <h1 class="logo">QRoll | You got Rickrolled</h1>
    <h1 class="logo-mobile">QRoll</h1>
    <a href="/QRoll/" class="icon" onclick="mobnav()">
        <i class="fa fa-home"></i>
      </a>
	<nav>
	<nav>
		<ul class="nav-area top-nav">
			<li><a href="/QRoll/">Home</a></li>
		</ul>
	</nav>
</header> 
<body>     
<div class="container">
    <h1 align="center">Never Gonna Give You Up</h1>
    <p align="center" id="holder" style="display: none">The video has finished, report the QRoll with the form</p>
    <p align="center" id="stop" style="display: none">The video has been stopped due to input</p>
    <p align="center"><iframe id="yt-embed" src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?controls=0&autoplay=1&fs=0&modestbranding=1&disablekb=1&end=60" title="YouTube video player" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture;" allowfullscreen></iframe></p>
</div>
<div class="container">
    <h1 align="center">Please report your finding!</h1>
    <form action="" id="QRForm">    
        <div class="row">    
    
        <div class="row">    
          <div class="col-25">    
            <label for="code">Code</label>    
          </div>    
          <div class="col-75">    
            <!-- TODO Fetch codes from DB -->
            <input id="code" type="tel" maxlength="3" size="3" pattern="[0-9]{3}" placeholder="Please enter the 3 digit code found on the QRoll">
          </div>
        </div>    
        <div class="row">
          <div class="col-25">    
            <label for="Location">Location</label>
          </div>    
          <div class="col-75">    
            <textarea id="subject" maxlength="1200" name="body" placeholder="Please describe where you found the QRoll, use an address and reference points, or even better use geographical cordinates" style="height:200px"></textarea>    
          </div>
        </div>    
        <div class="row">
            <input class="home-btn" type="submit" value="Send">    
            <p id="switchoff" style="display: none;">
              Can't find the code? <a onclick="toggleimg()">close reference</a>
            </p>
            <p id="switchon">
              Can't find the code? <a onclick="toggleimg()">open reference</a>
            </p>
            <img class="qrimg" src="/QRoll/assets/qrref.png" id="qrimg" alt="QRCode" style="display: none;">
          </div>    
        </form>
    </div>
    <script>
    function toggleimg() {
    var qrimg = document.getElementById("qrimg");
    var offtxt = document.getElementById("switchoff");
    var ontxt = document.getElementById("switchon");
    if (qrimg.style.display === "none") {
      ontxt.style.display = "none";
      offtxt.style.display = "block";
      qrimg.style.display = "block";
    } else {
      ontxt.style.display = "block";
      offtxt.style.display = "none";
      qrimg.style.display = "none";
    }
  }
    </script>
    <script>
      document.querySelector('input').addEventListener('input', function() {
        document.getElementById("yt-embed").style.display = "none";
        var elem = document.getElementById("yt-embed");
        elem.remove();
        document.getElementById("stop").style.display = "block";
    });
        setTimeout(function() {
      document.getElementById("yt-embed").style.display = "none";
      document.getElementById("holder").style.display = "block";
    }, 60000);
    </script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";
         
        // Paste the code from Firebase
        const firebaseConfig = {
        apiKey: "AIzaSyDYymYZFqhXG6U5weoSltXIwJfinvBAQsc",
        authDomain: "qroll-9eefa.firebaseapp.com",
        databaseURL: "https://qroll-9eefa-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "qroll-9eefa",
        storageBucket: "qroll-9eefa.appspot.com",
        messagingSenderId: "199837968072",
        appId: "1:199837968072:web:78e7dae9cf3d5a62e1a7fd"
        };
         
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
         
        // Get a reference to the database service
        const db = getDatabase(app);
        const now = new Date()
        const qrid = document.getElementById('code').value
        set(ref(db, 'prod/nav/' + new Date().toUTCString()), {
                useragent: navigator.userAgent,
                epoch: new Date().getTime(),
                page: "/r"
            });
        console.log(db, 'prod/form/' + document.getElementById('code').value + '/')
        document.getElementById('QRForm').addEventListener('submit', function(e) {
            e.preventDefault();
            set(ref(db, 'prod/form/' + document.getElementById('code').value + '/' + new Date().getTime()), {
                QRoll_id: document.getElementById('code').value,
                location: document.getElementById('subject').value,
                epoch: new Date().getTime(),
                date: new Date().toUTCString(),
                useragent: navigator.userAgent
            });
            document.getElementById('QRForm').reset();
            location.href='/QRoll/r/thx'
            
        });
        </script>
</div>
<div class="features-grid">
<footer>
    <p id="version">
        vx.x.x - db
    </p>
</footer>
<script>
  fetch('https://vincenzo160.github.io/QRoll/version.json')
  .then(response => response.json())
  .then(data => {
    var version = data.version;
    document.getElementById('version').innerHTML = version;
  });
</script>